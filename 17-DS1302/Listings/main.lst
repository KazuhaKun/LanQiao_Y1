C51 COMPILER V9.54   MAIN                                                                  03/13/2025 19:40:45 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          // // #include <reg52.h>
   2          #include <STC15F2K60S2.h>
   3          #include "ds1302.h"
   4          
   5          code unsigned char WRITE_RTC_ADDR[7] = {0x80,0x82,0x84,0x86,0x88,0x8a,0x8c};
   6          code unsigned char READ_RTC_ADDR[7] = {0x81,0x83,0x85,0x87,0x89,0x8b,0x8d};
   7          //20-4-18 sat. 23:59:24
   8          unsigned char Timer[] = {0x24,0x59,0x23,0x18,0x04,0x06,0x20};
   9          
  10          void DS1302_Config(){
  11   1        char i;
  12   1        Write_Ds1302_Byte(0x8e,0x00); //Disable WP
  13   1        for(i=0;i<7;i++){
  14   2          Write_Ds1302_Byte(WRITE_RTC_ADDR[i],Timer[i]);
  15   2        }
  16   1        Write_Ds1302_Byte(0x8e,0x80); //Enable WP
  17   1      }
  18          void Read_DS1302_Timer(){
  19   1        char i;
  20   1        for(i=0;i<7;i++){
  21   2          Timer[i]=Read_Ds1302_Byte(READ_RTC_ADDR[i]);
  22   2        }
  23   1      }
  24          
  25          //Delay
  26          void Delay(unsigned int t){
  27   1          while(t--);
  28   1      }
  29          
  30          //System Init
  31          void Set_HC573(unsigned char channel,unsigned char dat){
  32   1        P2 = (P2 & 0x1f) | (channel << 5);
  33   1        P0 = dat;
  34   1      }
  35          unsigned char LED_State = 0xff;
  36          
  37          //SMG
  38          unsigned char SMGCode[] =
  39          {
  40          0xc0, //0
  41          0xf9, //1
  42          0xa4, //2
  43          0xb0, //3
  44          0x99, //4
  45          0x92, //5
  46          0x82, //6
  47          0xf8, //7
  48          0x80, //8
  49          0x90, //9
  50          0x88, //A
  51          0x83, //b
  52          0xc6, //C
  53          0xa1, //d
  54          0x86, //E
C51 COMPILER V9.54   MAIN                                                                  03/13/2025 19:40:45 PAGE 2   

  55          0x8e, //F
  56          0xBF, //-
  57          0xff //None
  58          };
  59          void SMG(unsigned char Location,unsigned char num){
  60   1          Set_HC573(6,(0x01 << Location));
  61   1          Set_HC573(7, SMGCode[num]);
  62   1          Delay(500);
  63   1        Set_HC573(7,0xff);
  64   1      }
  65          void SMGDot(unsigned char Location,unsigned char num){
  66   1          Set_HC573(6,(0x01 << Location));
  67   1          Set_HC573(7, SMGCode[num]-0x80);
  68   1          Delay(500);
  69   1        Set_HC573(7,0xff);
  70   1      }
  71          
  72          void KeyDetect(){
  73   1      
  74   1      }
  75          
  76          void Display_DS1302(){
  77   1        SMG(0,Timer[2]/16);
  78   1        SMG(1,Timer[2]%16);
  79   1        SMG(2,16);
  80   1        SMG(3,Timer[1]/16);
  81   1        SMG(4,Timer[1]%16);
  82   1        SMG(5,16);
  83   1        SMG(6,Timer[0]/16);
  84   1        SMG(7,Timer[0]%16);
  85   1        Set_HC573(6,0xff);
  86   1        Set_HC573(7,0xff);  //Disable SMG
  87   1      }
  88          
  89          void InitSystem(){
  90   1        Set_HC573(0,0x00);
  91   1        Set_HC573(5,0x00);  //Disable Buzzer
  92   1        Set_HC573(4,0xff);  //Disable LED
  93   1        Set_HC573(6,0xff);
  94   1        Set_HC573(7,0xff);  //Disable SMG
  95   1      }
  96          
  97          void main()
  98          {
  99   1          InitSystem();
 100   1          Delay(100);
 101   1        DS1302_Config();
 102   1          while(1)
 103   1          {
 104   2          Read_DS1302_Timer();
 105   2          Display_DS1302();
 106   2          }
 107   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    345    ----
   CONSTANT SIZE    =     14    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     26       2
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.54   MAIN                                                                  03/13/2025 19:40:45 PAGE 3   

   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
