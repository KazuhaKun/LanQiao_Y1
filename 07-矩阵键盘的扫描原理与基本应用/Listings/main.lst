C51 COMPILER V9.54   MAIN                                                                  03/02/2025 18:55:06 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          // #include <reg52.h>
   2          #include <STC15F2K60S2.h>
   3          
   4          sbit L1 = P0^0;
   5          sbit L2 = P0^1;
   6          sbit L3 = P0^2;
   7          sbit L4 = P0^3;
   8          sbit L5 = P0^4;
   9          sbit L6 = P0^5;
  10          
  11          sbit X1 = P3^0;
  12          sbit X2 = P3^1;
  13          sbit X3 = P3^2;
  14          sbit X4 = P3^3;
  15          sbit Y1 = P4^4;
  16          sbit Y2 = P4^2;
  17          sbit Y3 = P3^5;
  18          sbit Y4 = P3^4;
  19          
  20          unsigned char CurrentKeyNum = 0;
  21          
  22          unsigned char NixieCode[] = {
  23              0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7D, 0x07, 0x7F, 0x6F, 
  24              0x77, 0x7C, 0x39, 0x5e, 0x79, 0x71,
  25              0x00, 0x40};
  26          
  27          void Delay(unsigned int t)
  28          {
  29   1          while(t--);
  30   1          // while(t--);
  31   1      }
  32          
  33          void InitHC138(unsigned char channel)
  34          {
  35   1          P2 = (P2 & 0x1f) | (channel << 5);
  36   1      }
  37          
  38          void OutPutP0(unsigned char channel,unsigned char dat)
  39          {
  40   1          InitHC138(channel);
  41   1          P0 = dat;
  42   1      }
  43          
  44          void InitSystem()
  45          {
  46   1          OutPutP0(5,0x00);   // Disable Buzzer
  47   1      }
  48          
  49          void Nixie(unsigned char Mode,unsigned char Num,unsigned char Location)
  50          {
  51   1          switch (Mode)
  52   1          {
  53   2              case 1:
  54   2              {
C51 COMPILER V9.54   MAIN                                                                  03/02/2025 18:55:06 PAGE 2   

  55   3                  OutPutP0(6,0x01 << ((Location-1)%8));
  56   3                  OutPutP0(7,~NixieCode[Num]);
  57   3                  // OutPutP0(7,0xff);
  58   3                  break;
  59   3              }
  60   2              case 2:
  61   2              {
  62   3                  OutPutP0(6,Location);
  63   3                  OutPutP0(7,~NixieCode[Num]);
  64   3                  // OutPutP0(7,0xff);
  65   3                  break;
  66   3              }
  67   2          }
  68   1      }
  69          
  70          void DisplayKeyNum(unsigned char value)
  71          {
  72   1          Nixie(1,value-1,1);
  73   1          Delay(500);
  74   1      }
  75          
  76          
  77          
  78          unsigned char MatrixKey()
  79          {
  80   1          unsigned char KeyNum = 0;
  81   1      
  82   1          P3 |= 0x3F;
  83   1          P42 = 1;
  84   1          P44 = 1;
  85   1      
  86   1          X1 = 0;
  87   1          if(Y1 == 0) {while(Y1 == 0);KeyNum = 1;}
  88   1          if(Y2 == 0) {while(Y2 == 0);KeyNum = 2;}
  89   1          if(Y3 == 0) {while(Y3 == 0);KeyNum = 3;}
  90   1          if(Y4 == 0) {while(Y4 == 0);KeyNum = 4;}
  91   1      
  92   1          P3 |= 0x3F;
  93   1          P42 = 1;
  94   1          P44 = 1;
  95   1      
  96   1          X2 = 0;
  97   1          if(Y1 == 0) {while(Y1 == 0);KeyNum = 5;}
  98   1          if(Y2 == 0) {while(Y2 == 0);KeyNum = 6;}
  99   1          if(Y3 == 0) {while(Y3 == 0);KeyNum = 7;}
 100   1          if(Y4 == 0) {while(Y4 == 0);KeyNum = 8;}
 101   1      
 102   1          P3 |= 0x3F;
 103   1          P42 = 1;
 104   1          P44 = 1;
 105   1      
 106   1          X3 = 0;
 107   1          if(Y1 == 0) {while(Y1 == 0);KeyNum = 9;}
 108   1          if(Y2 == 0) {while(Y2 == 0);KeyNum = 10;}
 109   1          if(Y3 == 0) {while(Y3 == 0);KeyNum = 11;}
 110   1          if(Y4 == 0) {while(Y4 == 0);KeyNum = 12;}
 111   1      
 112   1          P3 |= 0x3F;
 113   1          P42 = 1;
 114   1          P44 = 1;
 115   1      
 116   1          X4 = 0;
C51 COMPILER V9.54   MAIN                                                                  03/02/2025 18:55:06 PAGE 3   

 117   1          if(Y1 == 0) {while(Y1 == 0);KeyNum = 13;}
 118   1          if(Y2 == 0) {while(Y2 == 0);KeyNum = 14;}
 119   1          if(Y3 == 0) {while(Y3 == 0);KeyNum = 15;}
 120   1          if(Y4 == 0) {while(Y4 == 0);KeyNum = 16;}
 121   1      
 122   1          return KeyNum;
 123   1      }
 124          
 125          void main()
 126          {
 127   1          unsigned char keyValue;
 128   1      
 129   1          InitSystem();
 130   1          Delay(60000);
 131   1          OutPutP0(4,0xff);
 132   1          while(1)
 133   1          {        
 134   2              keyValue = MatrixKey();
 135   2              if(keyValue != 0)
 136   2              {
 137   3                  CurrentKeyNum = keyValue;
 138   3              }
 139   2              DisplayKeyNum(CurrentKeyNum);
 140   2          }
 141   1      }
 142          
 143          
 144          //注意位运算的意义，如|才可以将某一位设为1，&才可以将某一位设为0


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    305    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
