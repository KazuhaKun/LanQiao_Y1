C51 COMPILER V9.54   MAIN                                                                  03/04/2025 19:35:36 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          // #include <reg52.h>
   2          #include <STC15F2K60S2.h>
   3          
   4          sbit S4 = P3^3;
   5          sbit S5 = P3^2;
   6          
   7          //System Init
   8          void Delay(unsigned int t) {
   9   1          while(t--);
  10   1      }
  11          void InitHC138(unsigned char channel) {
  12   1          P2 = (P2 & 0x1f) | (channel << 5);
  13   1      }
  14          void OutPutP0(unsigned char channel,unsigned char dat){
  15   1          InitHC138(channel);
  16   1          P0 = dat;
  17   1      }
  18          void Disable_Buzzer(){
  19   1          OutPutP0(5,0x00);   // Disable Buzzer
  20   1      }
  21          //Nixie Display
  22          unsigned char NixieCode[] = {
  23              0x3F, 0x06, 0x5B, 0x4F, 0x66, 0x6D, 0x7D, 0x07, 0x7F, 0x6F, 
  24              0x77, 0x7C, 0x39, 0x5e, 0x79, 0x71,
  25              0x00, 0x40};
  26          void Nixie(unsigned char mode,unsigned char Location,unsigned char num)
  27          {
  28   1          switch (mode)
  29   1          {
  30   2              case 1:
  31   2              {
  32   3                  OutPutP0(6,0x01 << (Location - 1));
  33   3                  OutPutP0(7,~NixieCode[num]);
  34   3                  Delay(500);
  35   3                  break;
  36   3              }
  37   2              case 2:
  38   2              {
  39   3                  OutPutP0(6,Location);
  40   3                  OutPutP0(7,~NixieCode[num]);
  41   3                  break;
  42   3              }
  43   2          }
  44   1      }
  45          //Timer0
  46          void InitTimer0()
  47          {
  48   1          TMOD &= 0xf0;
  49   1          TMOD |= 0x01;
  50   1      
  51   1          //定时50ms
  52   1          TH0 = (65535 - 50000) / 256;
  53   1          TL0 = (65535 - 50000) % 256;
  54   1      
C51 COMPILER V9.54   MAIN                                                                  03/04/2025 19:35:36 PAGE 2   

  55   1          ET0 = 1;
  56   1          EA = 1;
  57   1          TR0 = 1;
  58   1      }
  59          
  60          unsigned char minSec,Sec,Min;
  61          unsigned char State;
  62          
  63          void Clear_Time()
  64          {
  65   1          minSec = 0;
  66   1          Sec = 0;
  67   1          Min = 0;
  68   1      }
  69          
  70          void TimeDisplay()
  71          {
  72   1          Nixie(1,1,Min/10);
  73   1          Nixie(1,2,Min%10);
  74   1          Nixie(1,3,17);
  75   1          Nixie(1,4,Sec/10);
  76   1          Nixie(1,5,Sec%10);
  77   1          Nixie(1,6,17);
  78   1          Nixie(1,7,minSec/10);
  79   1          Nixie(1,8,minSec%10);
  80   1      }
  81          
  82          void KeyDetect()
  83          {
  84   1          if(S4 == 0)
  85   1          {
  86   2              Delay(100);
  87   2              if(S4 == 0) 
  88   2              {
  89   3                  State = !State;
  90   3                  while(S4 ==0) TimeDisplay();
  91   3              }
  92   2          }
  93   1          if(S5 == 0)
  94   1          {
  95   2              Delay(100);
  96   2              if(S5 == 0)
  97   2              {
  98   3                  Clear_Time();
  99   3                  while(S5 ==0) TimeDisplay();
 100   3              }
 101   2          }
 102   1      }
 103          
 104          void Time()
 105          {
 106   1          if(State == 1)
 107   1          {
 108   2              if(minSec == 20){minSec=0;Sec++;}
 109   2              if(Sec == 60){Sec=0;Min++;}
 110   2              if(Min == 99){Min = 0;}
 111   2          }
 112   1      }
 113          
 114          void main()
 115          {
 116   1          Disable_Buzzer();
C51 COMPILER V9.54   MAIN                                                                  03/04/2025 19:35:36 PAGE 3   

 117   1          InitTimer0();
 118   1          Delay(60000);
 119   1          OutPutP0(4,0xff);
 120   1          State = 0;
 121   1          while(1)
 122   1          {
 123   2              TimeDisplay();
 124   2              KeyDetect();
 125   2          }
 126   1      }
 127          
 128          void ServiceTimer0() interrupt 1
 129          {
 130   1          static unsigned char Count = 0;
 131   1          // static unsigned char Count1 = 0;
 132   1          TH0 = (65535 - 50000) / 256;
 133   1          TL0 = (65535 - 50000) % 256;
 134   1          Count++;
 135   1          if(State == 1 && Count) minSec++;
 136   1          // if(Count) KeyDetect();
 137   1          Time();
 138   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    372    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
