C51 COMPILER V9.54   MAIN                                                                  03/06/2025 20:19:36 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          // #include <reg52.h>
   2          #include <STC15F2K60S2.h>
   3          
   4          sbit L1 = P0^0;
   5          sbit S7 = P3^0;
   6          
   7          //System Init
   8          void Delay(unsigned int t) {
   9   1          while(t--);
  10   1      }
  11          void InitHC138(unsigned char channel) {
  12   1          P2 = (P2 & 0x1f) | (channel << 5);
  13   1      }
  14          void OutPutP0(unsigned char channel,unsigned char dat){
  15   1          InitHC138(channel);
  16   1          P0 = dat;
  17   1      }
  18          void Disable_Buzzer(){
  19   1          OutPutP0(5,0x00);   // Disable Buzzer
  20   1      }
  21          void Disable_LED(){
  22   1          OutPutP0(4,0xff);
  23   1      }
  24          void InitSystem(){
  25   1          Disable_Buzzer();
  26   1          Disable_LED();
  27   1      }
  28          
  29          
  30          unsigned char urdat;
  31          
  32          void SendByte(unsigned char dat);
  33          
  34          void InitUART()
  35          {
  36   1          TMOD = 0x20;
  37   1          TH1 = 0xfd;
  38   1          TL1 = 0xfd;
  39   1          TR1 = 1;
  40   1      
  41   1          SCON = 0x50;
  42   1          AUXR = 0x00;
  43   1      
  44   1          ES = 1;
  45   1          EA = 1;
  46   1      
  47   1      }
  48          unsigned char command = 0x00;
  49          
  50          void ServiceUART() interrupt 4
  51          {
  52   1          if(RI == 1)
  53   1          {
  54   2              RI = 0;     //人工清零
C51 COMPILER V9.54   MAIN                                                                  03/06/2025 20:19:36 PAGE 2   

  55   2              command = SBUF;
  56   2          }
  57   1          // if(TI == 1)
  58   1          // {
  59   1      
  60   1          // }
  61   1      }
  62          
  63          void SendByte(unsigned char dat)
  64          {
  65   1          SBUF = dat;
  66   1          while(TI == 0);
  67   1          TI = 0;
  68   1      }
  69          
  70          void SendString(unsigned char *str)
  71          {
  72   1          while(*str != '\0'){
  73   2              SendByte(*str++);
  74   2          }
  75   1      }
  76          
  77          void Working()
  78          {
  79   1          if(command != 0x00)
  80   1          {
  81   2              switch(command & 0xf0)
  82   2              {
  83   3                  case 0xa0:
  84   3                  P0 = (P0 & 0xf0) | ~(command & 0x0f);
  85   3                  command = 0x00;
  86   3                  break;
  87   3      
  88   3                  case 0xb0:
  89   3                  P0 = (P0 & 0x0F) | ~((command & 0x0f) << 4);
  90   3                  command = 0x00;
  91   3                  break;
  92   3      
  93   3                  case 0xc0:
  94   3                  SendString("The System is Running...\r\n");
  95   3                  command = 0x00;
  96   3                  break;
  97   3              }
  98   2          }
  99   1      }
 100          
 101          void main()
 102          {
 103   1          InitSystem();
 104   1          Delay(60000);
 105   1          InitUART();
 106   1          SendString("Welcome to XMF System!\r\n");
 107   1          while(1)
 108   1          {
 109   2              Working();
 110   2          }
 111   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    215    ----
   CONSTANT SIZE    =     52    ----
C51 COMPILER V9.54   MAIN                                                                  03/06/2025 20:19:36 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
