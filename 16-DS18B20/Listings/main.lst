C51 COMPILER V9.54   MAIN                                                                  03/12/2025 20:10:00 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          // // #include <reg52.h>
   2          #include <STC15F2K60S2.h>
   3          #include "onewire.h"
   4          
   5          //Delay
   6          void DelaySMG(unsigned int t){
   7   1          while(t--);
   8   1      }
   9          
  10          void SMGDisplay();
  11          // void Delay(unsigned int t){
  12          //     while(t--) SMGDisplay();
  13          // }
  14          
  15          //System Init
  16          void Set_HC573(unsigned char channel,unsigned char dat){
  17   1        P2 = (P2 & 0x1f) | (channel << 5);
  18   1        P0 = dat;
  19   1      }
  20          unsigned char LED_State = 0xff;
  21          
  22          //SMG
  23          unsigned char SMGCode[] =
  24          {
  25          0xc0, //0
  26          0xf9, //1
  27          0xa4, //2
  28          0xb0, //3
  29          0x99, //4
  30          0x92, //5
  31          0x82, //6
  32          0xf8, //7
  33          0x80, //8
  34          0x90, //9
  35          0x88, //A
  36          0x83, //b
  37          0xc6, //C
  38          0xa1, //d
  39          0x86, //E
  40          0x8e, //F
  41          0xBF, //-
  42          0xff //None
  43          };
  44          void SMG(unsigned char Location,unsigned char num){
  45   1          Set_HC573(6,(0x01 << Location));
  46   1          Set_HC573(7, SMGCode[num]);
  47   1          DelaySMG(500);
  48   1        Set_HC573(7,0xff);
  49   1      }
  50          void SMGDot(unsigned char Location,unsigned char num){
  51   1          Set_HC573(6,(0x01 << Location));
  52   1          Set_HC573(7, SMGCode[num]-0x80);
  53   1          DelaySMG(500);
  54   1        Set_HC573(7,0xff);
C51 COMPILER V9.54   MAIN                                                                  03/12/2025 20:10:00 PAGE 2   

  55   1      }
  56          
  57          //18B20
  58          int temp;
  59          void Init_18B20(){
  60   1        char i;
  61   1        init_ds18b20();
  62   1        Write_DS18B20(0xcc);
  63   1        Write_DS18B20(0x44);
  64   1        for(i=0;i<8;i++){
  65   2          DelaySMG(60000);
  66   2        }
  67   1      }
  68          void Read_DS18B20_Temp(){
  69   1          unsigned char LSB,MSB;
  70   1          int dat;
  71   1      
  72   1          init_ds18b20();
  73   1        SMGDisplay();
  74   1          Write_DS18B20(0xcc);
  75   1          Write_DS18B20(0x44);
  76   1      
  77   1          SMGDisplay();
  78   1      
  79   1          init_ds18b20();
  80   1        SMGDisplay();
  81   1          Write_DS18B20(0xcc);
  82   1          Write_DS18B20(0xbe);
  83   1          LSB = Read_DS18B20();
  84   1          MSB = Read_DS18B20();
  85   1      
  86   1        SMGDisplay();
  87   1      
  88   1          dat = MSB;
  89   1          dat = (dat << 8) | LSB;
  90   1      
  91   1          if((dat & 0xf800) == 0x0000){
  92   2          temp = dat >> 4;
  93   2          temp = temp * 100;
  94   2          temp += ((dat & 0x0f)*100)/16;
  95   2        }
  96   1          else if((dat & 0xf800) == 0xf800){
  97   2          dat = ~dat + 1;
  98   2          temp = dat >> 4;
  99   2          temp = temp * 100;
 100   2          temp += ((dat & 0x0f)*100)/16;
 101   2          temp = - temp;
 102   2        }
 103   1        SMGDisplay();
 104   1      }
 105          
 106          void SMGDisplay(){
 107   1        int ads_temp;
 108   1        if(temp>=0){
 109   2          ads_temp = temp;
 110   2          if(ads_temp > 999) SMG(4,ads_temp/1000);
 111   2          SMGDot(5,ads_temp/100%10);
 112   2          SMG(6,ads_temp/10%10);
 113   2          SMG(7,ads_temp%10);
 114   2        }
 115   1        if(temp<0){
 116   2          ads_temp = -temp;
C51 COMPILER V9.54   MAIN                                                                  03/12/2025 20:10:00 PAGE 3   

 117   2          SMG(3,16);
 118   2          if(ads_temp > 999) SMG(4,ads_temp/1000);
 119   2          SMGDot(5,ads_temp/100%10);
 120   2          SMG(6,ads_temp/10%10);
 121   2          SMG(7,ads_temp%10);
 122   2        }
 123   1      }
 124          
 125          void InitSystem(){
 126   1        Set_HC573(0,0x00);
 127   1        Set_HC573(5,0x00);  //Disable Buzzer
 128   1        Set_HC573(4,0xff);  //Disable LED
 129   1        Set_HC573(6,0xff);
 130   1        Set_HC573(7,0xff);  //Disable SMG
 131   1        Init_18B20();
 132   1      }
 133          
 134          void main()
 135          {
 136   1          InitSystem();
 137   1          DelaySMG(100);
 138   1          while(1)
 139   1          {
 140   2              Read_DS18B20_Temp();
 141   2              SMGDisplay();
 142   2          }
 143   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    552    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
